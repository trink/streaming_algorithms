
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>heka_message_monitor Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../../../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-navigator/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="heka_message_volume_monitor.old.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../../../">
            
                <a href="../../../../../">
            
                    
                    Streaming Algorithms (0.0.5)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <a target="_blank" href="https://trink.github.io/streaming_algorithms/doxygen/index.html">
            
                    
                    Library Documentation
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Lua Bindings</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../../../../lua_cm_sketch.html">
            
                <a href="../../../../../lua_cm_sketch.html">
            
                    
                    Count-min Sketch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../../../../lua_matrix.html">
            
                <a href="../../../../../lua_matrix.html">
            
                    
                    Matrix
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../../../../lua_p2.html">
            
                <a href="../../../../../lua_p2.html">
            
                    
                    Piecewise Parabolic Prediction (P2)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../../../../../lua_running_stats.html">
            
                <a href="../../../../../lua_running_stats.html">
            
                    
                    Running Stats
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../../../../../lua_time_series.html">
            
                <a href="../../../../../lua_time_series.html">
            
                    
                    Time Series
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Lua Sandbox Extensions</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../">
            
                <a href="../../">
            
                    
                    sandboxes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../">
            
                <a href="../">
            
                    
                    heka
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1.1" data-path="./">
            
                <a href="./">
            
                    
                    analysis
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="3.1.1.1.1" data-path="heka_message_monitor.html">
            
                <a href="heka_message_monitor.html">
            
                    
                    heka_message_monitor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.1.1.2" data-path="heka_message_volume_monitor.old.html">
            
                <a href="heka_message_volume_monitor.old.html">
            
                    
                    heka_message_volume_monitor.old
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../../../.." >heka_message_monitor</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="Heka_Message_Monitor">Heka Message Monitor</h1>
<p>Analyzes each unique message in a data stream based on the specified hierarchy.
This schema is used for automated monitoring of all message attributes for any
change in behavior.</p>
<h2 id="Sample_Configuration">1. Sample Configuration</h2>
<p>The defaults are commented out.</p>
<pre><code class="lang-lua">filename        = <span class="hljs-string">&quot;heka_message_monitor.lua&quot;</span>
ticker_interval = <span class="hljs-number">360</span>
preserve_data   = <span class="hljs-keyword">true</span>
message_matcher = <span class="hljs-string">&quot;Uuid &lt; &apos;\003&apos;&quot;</span> <span class="hljs-comment">-- slightly greater than a 1% sample</span>
timer_event_inject_limit = <span class="hljs-number">1000</span>

<span class="hljs-comment">-- hierarchy           = {&quot;Logger&quot;}</span>
<span class="hljs-comment">-- max_set_size        = 255</span>
<span class="hljs-comment">-- samples             = 25</span>
<span class="hljs-comment">-- sample_interval     = 3600</span>
<span class="hljs-comment">-- histogram_buckets   = 25</span>
<span class="hljs-comment">-- exclude             = nil -- table of field names to exclude from monitoring/analyis</span>
                             <span class="hljs-comment">-- e.g. `{&quot;Pid&quot;, &quot;Fields[Date]&quot;}` hierarchy will always be appended</span>
<span class="hljs-comment">-- preservation_version = 1  -- increase when altering any of the above configuration values</span>

alert = {
<span class="hljs-comment">--  disabled  = false,</span>
  prefix    = <span class="hljs-keyword">true</span>,
<span class="hljs-comment">--  throttle  = 90,</span>
  modules   = {
    email = {recipients = {<span class="hljs-string">&quot;example@example.com&quot;</span>}},
  },
  thresholds = {
    <span class="hljs-comment">-- pcc              = 0.3,  -- minimum correlation coefficient (less than or equal alerts)</span>
    <span class="hljs-comment">-- submissions      = 1000, -- minimum number of submissions before alerting in at least the current and two previous interval (pcc)</span>
    <span class="hljs-comment">-- duplicate_change = nil, -- +/- percentage of the duplicate range i.e. 50% of a 10-12% range is +/- 1% so anything outside of 9-13% will alert allowing the range to creep and self adjust; warning this limits it to only detecting large jumps. The minimum number of submissions before alerting is 50K due to the HLL estimation error.  The alert is based on the last full hour, not the current hour, as the estimate takes a while to stabilize for some fields.</span>
  }
}
</code></pre>
<h2 id="Analysis_Behavior_(based_on_subtype)">2. Analysis Behavior (based on subtype)</h2>
<ul>
<li><code>unknown</code> - no analysis</li>
<li><code>unique</code>  - hyperloglog percent duplicate calculation (per interval)</li>
<li><code>range</code>   - histogram analysis of the range</li>
<li><code>set</code>     - histogram analysis of the enumerated set</li>
<li><code>sparse</code>  - weights of each of the most frequent items are computed</li>
</ul>
<p>source code: <a href="https://github.com/mozilla-services/lua_sandbox_extensions/blob/master/lua_binding/luasandbox/sandboxes/heka/analysis/heka_message_monitor.lua" target="_blank">heka_message_monitor.lua</a></p>
<div id="anchors-navbar"><i class="fa fa-anchor"></i><ul><p><a href="#Heka_Message_Monitor">Heka Message Monitor</a></p><li><a href="#Sample_Configuration">1. Sample Configuration</a></li><li><a href="#Analysis_Behavior_(based_on_subtype)">2. Analysis Behavior (based on subtype)</a></li></ul></div><a href="#Sample_Configuration" id="goTop"><i class="fa fa-arrow-up"></i></a>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: analysis">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="heka_message_volume_monitor.old.html" class="navigation navigation-next " aria-label="Next page: heka_message_volume_monitor.old">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"heka_message_monitor","level":"3.1.1.1.1","depth":4,"next":{"title":"heka_message_volume_monitor.old","level":"3.1.1.1.2","depth":4,"path":"lua_binding/luasandbox/sandboxes/heka/analysis/heka_message_volume_monitor.old.md","ref":"lua_binding/luasandbox/sandboxes/heka/analysis/heka_message_volume_monitor.old.md","articles":[]},"previous":{"title":"analysis","level":"3.1.1.1","depth":3,"path":"lua_binding/luasandbox/sandboxes/heka/analysis/README.md","ref":"lua_binding/luasandbox/sandboxes/heka/analysis/README.md","articles":[{"title":"heka_message_monitor","level":"3.1.1.1.1","depth":4,"path":"lua_binding/luasandbox/sandboxes/heka/analysis/heka_message_monitor.md","ref":"lua_binding/luasandbox/sandboxes/heka/analysis/heka_message_monitor.md","articles":[]},{"title":"heka_message_volume_monitor.old","level":"3.1.1.1.2","depth":4,"path":"lua_binding/luasandbox/sandboxes/heka/analysis/heka_message_volume_monitor.old.md","ref":"lua_binding/luasandbox/sandboxes/heka/analysis/heka_message_volume_monitor.old.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["navigator"],"pluginsConfig":{"navigator":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"lua_binding/luasandbox/sandboxes/heka/analysis/heka_message_monitor.md","mtime":"2018-11-14T15:09:54.949Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2018-11-14T15:10:00.565Z"},"basePath":"../../../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../../../gitbook/gitbook.js"></script>
    <script src="../../../../../gitbook/theme.js"></script>
    
        
        <script src="../../../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

